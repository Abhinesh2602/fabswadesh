{%- comment -%}
  FULL Swiper + PhotoSwipe viewer integration in Shopify product page
{%- endcomment -%}

<!-- Swiper Styles -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css" />
<!-- PhotoSwipe Styles -->
{{ 'photoswipe.css' | asset_url | stylesheet_tag }}

<style>
  .product-zoom-icon {
    position: absolute;
    top: 24px;
    right: 24px;
    z-index: 10;
    width: 48px;
    height: 48px;
    background: #fff;
    border-radius: 50%;
    box-shadow: 0 2px 8px rgba(0,0,0,0.12);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: box-shadow 0.2s;
  }
  .product-zoom-icon:hover {
    box-shadow: 0 4px 16px rgba(0,0,0,0.18);
  }
  .product-zoom-icon svg {
    width: 24px;
    height: 24px;
    fill: #333;
  }
  .swiper-container {
    width: 100%;
    height: auto;
    position: relative;
  }
  .swiper-slide {
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .swiper-slide figure {
    margin: 0;
    width: 100%;
    min-height: 480px;
    height: 780px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  @media (max-width: 600px) {
    .swiper-slide figure {
      height: 550px !important;
      width: 100%;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      overflow: hidden;
      background: #fff;
    }

    .swiper-slide figure img {
      width: auto !important;
      object-fit: cover !important;
      display: block !important;
      margin: 0 auto !important;
      max-width: none !important;
    }
  }

  .swiper-slide figure img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }
  .swiper-button-next,
  .swiper-button-prev {
    color: #333;
    top: 50%;
    transform: translateY(-50%);
  }
  .swiper-thumbs {
    margin-top: 12px;
  }
  .swiper-thumbs .swiper-slide {
    width: 61px;
    height: 86px;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0.6;
    cursor: pointer;
    overflow: hidden;
    background: #fff;
  }
  .swiper-thumbs .swiper-slide-thumb-active {
    opacity: 1;
    border: 2px solid #000;
  }
  .swiper-thumbs .swiper-slide img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    background: #fff;
    display: block;
  }
</style>

<div class="photos">
  <div class="photos__item photos__item--main" data-aos="fade">
    <div class="product-zoom-icon" id="productZoomIcon" title="Zoom">
      <svg viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99c.41.41 1.09.41 1.5 0s.41-1.09 0-1.5l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path></svg>
    </div>
    <div class="swiper-container swiper-{{ section.id }}">
      <div class="swiper-wrapper">
        {%- for media in product.media -%}
        {% if media.media_type == 'image' %}
        <div class="swiper-slide">
          <figure class="product__photo-container">
            <a
              href="{{ media | image_url: width: 2048 }}"
              data-pswp-width="{{ media.width }}"
              data-pswp-height="{{ media.height }}"
              data-index="{{ forloop.index0 }}"
              data-image-id="{{ media.id }}"
              class="product__photo-wrapper"
              style="padding-top:{{ 1 | divided_by: media.aspect_ratio | times: 100 }}%;"
            >
              <img
                src="{{ media | image_url: width: 800 }}"
                alt="{{ media.alt | escape }}"
                width="{{ media.width }}"
                height="{{ media.height }}"
                loading="lazy"
              >
            </a>
          </figure>
        </div>
        {% endif %}
        {%- endfor -%}
      </div>
      <div class="swiper-button-next"></div>
      <div class="swiper-button-prev"></div>
    </div>
    <div class="swiper-container swiper-thumbs swiper-thumbs-{{ section.id }}">
      <div class="swiper-wrapper">
        {%- for media in product.media -%}
        {% if media.media_type == 'image' %}
        <div class="swiper-slide">
          <img src="{{ media | image_url: width: 120 }}" alt="{{ media.alt | escape }}" width="{{ media.width }}" height="{{ media.height }}">
        </div>
        {% endif %}
        {%- endfor -%}
      </div>
    </div>
  </div>
</div>

<!-- Swiper & PhotoSwipe Scripts -->
<script src="{{ 'swiper-bundle.min.js' | asset_url }}" defer="defer"></script>
<script src="{{ 'photoswipe.min.js' | asset_url }}" defer="defer"></script>
<script src="{{ 'photoswipe-ui-default.min.js' | asset_url }}" defer="defer"></script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const thumbSwiper = new Swiper(".swiper-thumbs-{{ section.id }}", {
      slidesPerView: 5,
      spaceBetween: 8,
      freeMode: true,
      watchSlidesProgress: true,
    });

    const mainSwiper = new Swiper(".swiper-{{ section.id }}", {
      slidesPerView: 1,
      spaceBetween: 10,
      loop: false,
      navigation: {
        nextEl: ".swiper-button-next",
        prevEl: ".swiper-button-prev",
      },
      thumbs: {
        swiper: thumbSwiper,
      },
    });

    // PhotoSwipe launch code
    var photoLinks = document.querySelectorAll('.product__photo-wrapper');
    var items = Array.from(photoLinks).map(function(link) {
      return {
        src: link.getAttribute('href'),
        w: parseInt(link.getAttribute('data-pswp-width')) || 800,
        h: parseInt(link.getAttribute('data-pswp-height')) || 600,
        title: link.querySelector('img') ? link.querySelector('img').alt : ''
      };
    });

    photoLinks.forEach(function(link, idx) {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        var pswpElement = document.querySelectorAll('.pswp')[0];
        var options = {
          index: idx,
          bgOpacity: 0.85,
          showHideOpacity: true
        };
        var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, options);
        gallery.init();
      });
    });

    // Zoom icon click opens PhotoSwipe at current slide
    var zoomIcon = document.getElementById('productZoomIcon');
    if (zoomIcon) {
      zoomIcon.addEventListener('click', function() {
        var pswpElement = document.querySelectorAll('.pswp')[0];
        var activeIndex = mainSwiper.activeIndex || 0;
        var options = {
          index: activeIndex,
          bgOpacity: 0.85,
          showHideOpacity: true
        };
        var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, options);
        gallery.init();
      });
    }
  });
</script>

